set -e 
source bin/tauconfig.sh
echo "tauDylib=$tauDylib" 
if  [ -z "$tauDylib"   ] ;then 
echo "zero"
echo "void init_stdlib(); void init_libs(){ init_stdlib(); }">built/stdlib.c
 clang -lm -pthread stdlib/*.c built/stdlib.c     bin/stdlib.bc  -o bin/stdlib 
else 
echo "non-zero"
clang -dynamiclib bin/stdlib.bc  -o built/stdlib.dylib  -init _init_stdlib -undefined dynamic_lookup
cc  stdlib/*.c -DLIBRARY -o bin/tauexe
fi
cc bin/putfile.c -o bin/putfile.cgi
makelibsrc stdlib.lib
time $tauDylib stdlib  stdlib > tmp/checkboot1.html
clang -lm -pthread  stdlib/*.c built/stdlib.c built/stdlib.bc  -o bin/stdlib
time $tauDylib stdlib  stdlib > tmp/checkboot2.html
clang -lm -pthread  stdlib/*.c built/stdlib.c built/stdlib.bc  -o bin/stdlib
time $tauDylib stdlib  stdlib > tmp/checkboot3.html
 clang -lm -pthread  stdlib/*.c built/stdlib.c built/stdlib.bc  -o bin/stdlib
$tauopen tmp/checkboot1.html
diff tmp/checkboot1.html tmp/checkboot2.html
if [ $? -ne 0 ] 
then 
  $tauopen tmp/checkboot2.html 
fi
diff tmp/checkboot1.html tmp/checkboot3.html
if [ $? -ne 0 ] 
then 
  $tauopen tmp/checkboot3.html 
fi
